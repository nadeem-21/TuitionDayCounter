<!-- trigger build -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tuition Day Counter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; max-width: 800px; margin: auto; }
    h1 { font-size: 22px; margin-bottom: 10px; }
    form { border: 1px solid #ccc; padding: 10px; border-radius: 6px; margin-bottom: 15px; }
    label { display: block; margin-top: 6px; font-size: 14px; }
    input, select, textarea { width: 100%; padding: 6px; margin-top: 2px; box-sizing: border-box; }
    button { padding: 6px 10px; margin-top: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #f3f3f3; }
    .small-btn { font-size: 11px; padding: 3px 6px; margin-right: 3px; }
  </style>
</head>
<body>
  <h1>Tuition Day Counter</h1>

  <!-- Student form -->
  <form id="studentForm">
    <input type="hidden" id="studentId" />
    <label>Student Name
      <input type="text" id="name" required />
    </label>
    <label>Class / Level
      <input type="text" id="classLevel" />
    </label>
    <label>Subjects
      <input type="text" id="subjects" placeholder="Physics, Chemistry, Math" />
    </label>
    <label>Routine (text)
      <textarea id="routine" rows="2" placeholder="Sat, Mon, Wed - 7:00pm to 8:45pm"></textarea>
    </label>
    <label>Notes
      <textarea id="notes" rows="2"></textarea>
    </label>
    <button type="submit">Save Student</button>
    <button type="button" onclick="resetForm()">Clear</button>
  </form>

  <!-- Students table -->
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Class</th>
        <th>Subjects</th>
        <th>Routine</th>
        <th>Total Days Tutored</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="studentsTableBody"></tbody>
  </table>

  <script>
// Key used in localStorage
const STORAGE_KEY = "tuition_students";

let students = [];

// Load data on start
window.addEventListener("DOMContentLoaded", () => {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    students = JSON.parse(saved);
  }
  renderTable();

  const form = document.getElementById("studentForm");
  form.addEventListener("submit", onSubmitStudentForm);
});

function saveToStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
}

function onSubmitStudentForm(e) {
  e.preventDefault();
  const idField = document.getElementById("studentId");
  const name = document.getElementById("name").value.trim();
  const classLevel = document.getElementById("classLevel").value.trim();
  const subjects = document.getElementById("subjects").value.trim();
  const routine = document.getElementById("routine").value.trim();
  const notes = document.getElementById("notes").value.trim();

  if (!name) {
    alert("Name is required");
    return;
  }

  if (idField.value) {
    // Edit existing
    const id = idField.value;
    const idx = students.findIndex(s => s.id === id);
    if (idx !== -1) {
      students[idx].name = name;
      students[idx].classLevel = classLevel;
      students[idx].subjects = subjects;
      students[idx].routine = routine;
      students[idx].notes = notes;
    }
  } else {
    // New student
    const newStudent = {
      id: Date.now().toString(),
      name,
      classLevel,
      subjects,
      routine,
      notes,
      attendance: [] // dates as strings: "2026-01-12"
    };
    students.push(newStudent);
  }

  saveToStorage();
  renderTable();
  resetForm();
}

function resetForm() {
  document.getElementById("studentId").value = "";
  document.getElementById("name").value = "";
  document.getElementById("classLevel").value = "";
  document.getElementById("subjects").value = "";
  document.getElementById("routine").value = "";
  document.getElementById("notes").value = "";
}

function renderTable() {
  const tbody = document.getElementById("studentsTableBody");
  tbody.innerHTML = "";

  students.forEach(student => {
    const tr = document.createElement("tr");

    const totalDays = student.attendance ? student.attendance.length : 0;

    tr.innerHTML = `
      <td>${escapeHtml(student.name)}</td>
      <td>${escapeHtml(student.classLevel || "")}</td>
      <td>${escapeHtml(student.subjects || "")}</td>
      <td>${escapeHtml(student.routine || "")}</td>
      <td>${totalDays}</td>
      <td>
        <button class="small-btn" onclick="editStudent('${student.id}')">Edit</button>
        <button class="small-btn" onclick="deleteStudent('${student.id}')">Delete</button>
        <button class="small-btn" onclick="markToday('${student.id}')">+ Day</button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

// Simple HTML escaping
function escapeHtml(text) {
  return String(text)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

function editStudent(id) {
  const student = students.find(s => s.id === id);
  if (!student) return;

  document.getElementById("studentId").value = student.id;
  document.getElementById("name").value = student.name;
  document.getElementById("classLevel").value = student.classLevel || "";
  document.getElementById("subjects").value = student.subjects || "";
  document.getElementById("routine").value = student.routine || "";
  document.getElementById("notes").value = student.notes || "";
}

function deleteStudent(id) {
  if (!confirm("Delete this student?")) return;
  students = students.filter(s => s.id !== id);
  saveToStorage();
  renderTable();
}

function markToday(id) {
  const student = students.find(s => s.id === id);
  if (!student) return;

  const today = new Date().toISOString().slice(0, 10); // "YYYY-MM-DD"
  if (!student.attendance) {
    student.attendance = [];
  }
  // Avoid duplicate for same day
  if (!student.attendance.includes(today)) {
    student.attendance.push(today);
  } else {
    if (!confirm("Already marked today. Add again?")) return;
    student.attendance.push(today);
  }

  saveToStorage();
  renderTable();
}
  </script>
</html>
</body>
</html>

